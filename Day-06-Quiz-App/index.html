<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Arcade Quiz</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f172a;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --neon-blue: #00f3ff;
            --neon-pink: #bc13fe;
            --neon-green: #0aff68;
            --neon-red: #ff0055;
            --neon-gold: #ffd700;
            --neon-orange: #ff9f43;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; }

        body {
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(188, 19, 254, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(0, 243, 255, 0.15) 0%, transparent 40%);
            font-family: 'Outfit', sans-serif;
            color: #fff;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        #confetti-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 99;
        }

        .app-container {
            width: 100%; max-width: 750px; padding: 20px;
            perspective: 1000px; z-index: 10;
        }

        .quiz-card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            padding: 40px;
            position: relative;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            min-height: 680px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: height 0.3s ease;
        }

        /* --- TYPOGRAPHY --- */
        .game-title {
            font-size: 3rem; font-weight: 800; margin-bottom: 10px; text-align: center;
            background: linear-gradient(to right, var(--neon-blue), var(--neon-pink));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(188, 19, 254, 0.3);
        }
        .subtitle { color: #ccc; margin-bottom: 30px; font-size: 1.1rem; text-align: center; }

        /* --- USER PROFILE --- */
        .user-profile-bar {
            display: flex; align-items: center; justify-content: center; gap: 15px;
            background: rgba(255,255,255,0.03); padding: 8px 20px; border-radius: 50px;
            margin-bottom: 30px; border: 1px solid rgba(255,255,255,0.1);
        }
        .user-info-text { font-size: 0.9rem; color: #aaa; }
        .user-name-highlight { color: #fff; font-weight: 700; margin-left: 5px; }
        .change-user-btn {
            background: transparent; border: 1px solid var(--neon-blue); color: var(--neon-blue);
            padding: 5px 12px; border-radius: 20px; cursor: pointer; font-size: 0.75rem; font-weight: 700;
            font-family: 'Outfit', sans-serif; transition: 0.2s; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .change-user-btn:hover { background: var(--neon-blue); color: #000; box-shadow: 0 0 10px var(--neon-blue); }

        #username-input {
            background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px; padding: 15px 25px; color: #fff; font-size: 1.5rem;
            font-family: 'Outfit', sans-serif; text-align: center; width: 100%; max-width: 350px;
            margin-bottom: 30px; outline: none; transition: 0.3s;
        }
        #username-input:focus { border-color: var(--neon-blue); box-shadow: 0 0 20px rgba(0, 243, 255, 0.3); }

        /* --- GRID LAYOUTS --- */
        .topic-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 15px; width: 100%; }
        .topic-card {
            background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px; padding: 20px; cursor: pointer; transition: all 0.3s;
            display: flex; flex-direction: column; align-items: center; gap: 10px; text-align: center;
        }
        .topic-card:hover {
            transform: translateY(-5px) scale(1.05); background: rgba(255, 255, 255, 0.08);
            border-color: var(--theme-color); box-shadow: 0 0 20px var(--theme-shadow);
        }
        .topic-icon { font-size: 2.5rem; }
        .topic-name { font-weight: 700; font-size: 0.95rem; }

        .topic-history { --theme-color: var(--neon-orange); --theme-shadow: rgba(255, 159, 67, 0.3); }
        .topic-tech { --theme-color: var(--neon-blue); --theme-shadow: rgba(0, 243, 255, 0.3); }
        .topic-psych { --theme-color: var(--neon-pink); --theme-shadow: rgba(188, 19, 254, 0.3); }
        .topic-finance { --theme-color: var(--neon-gold); --theme-shadow: rgba(255, 215, 0, 0.3); }
        .topic-econ { --theme-color: var(--neon-green); --theme-shadow: rgba(10, 255, 104, 0.3); }

        .diff-grid { display: flex; flex-direction: column; gap: 15px; width: 100%; max-width: 400px; }
        .diff-btn {
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px; border-radius: 15px; color: white;
            font-family: 'Outfit', sans-serif; font-size: 1.2rem; font-weight: 800;
            cursor: pointer; transition: 0.3s; display: flex; justify-content: space-between; align-items: center;
        }
        .diff-btn:hover { transform: scale(1.02); }
        .diff-easy:hover { border-color: var(--neon-green); background: rgba(10, 255, 104, 0.1); }
        .diff-mid:hover { border-color: var(--neon-blue); background: rgba(0, 243, 255, 0.1); }
        .diff-hard:hover { border-color: var(--neon-red); background: rgba(255, 0, 85, 0.1); }

        /* --- GAME HUD --- */
        .stats-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; width: 100%; }
        .hud-left { display: flex; flex-direction: column; gap: 8px; align-items: flex-start; }
        
        .badge {
            font-size: 0.8rem; font-weight: 700; background: rgba(0,0,0,0.3);
            padding: 5px 12px; border-radius: 20px; display: inline-flex; align-items: center; gap: 6px;
            border: 1px solid transparent; white-space: nowrap;
        }
        .streak-badge.on-fire { border-color: var(--neon-orange); color: var(--neon-orange); box-shadow: 0 0 10px rgba(255, 159, 67, 0.3); animation: pulse 1s infinite; }
        .topic-badge { color: var(--neon-blue); text-transform: uppercase; letter-spacing: 1px; }

        .timer-container { position: relative; width: 60px; height: 60px; flex-shrink: 0; }
        .timer-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .timer-circle {
            fill: none; stroke: var(--neon-blue); stroke-width: 6;
            stroke-dasharray: 157; stroke-dashoffset: 0;
            stroke-linecap: round; transition: stroke-dashoffset 1s linear, stroke 0.3s;
        }
        .timer-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: 800; font-size: 1.2rem; }

        .question-text {
            font-size: 1.4rem; font-weight: 800; line-height: 1.3; margin-bottom: 25px;
            text-shadow: 0 0 20px rgba(0,0,0,0.5); min-height: 80px; width: 100%; text-align: left;
        }
        .options-grid { display: grid; gap: 12px; width: 100%; }
        
        .option-btn {
            background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 16px 20px; border-radius: 16px; color: #fff; font-size: 1rem;
            font-weight: 500; cursor: pointer; transition: 0.2s; text-align: left; position: relative; overflow: hidden;
            font-family: 'Outfit', sans-serif; display: flex; align-items: center; gap: 15px;
        }
        .key-cap {
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;
            font-weight: 800; color: var(--neon-blue); font-size: 0.9rem; flex-shrink: 0;
        }
        .option-btn:hover:not(.disabled) { background: rgba(255, 255, 255, 0.1); transform: translateX(5px); border-color: rgba(255, 255, 255, 0.4); }
        .option-btn:hover:not(.disabled) .key-cap { background: var(--neon-blue); color: #000; }
        .option-btn.correct { background: rgba(10, 255, 104, 0.15); border-color: var(--neon-green); color: var(--neon-green); }
        .option-btn.correct .key-cap { background: var(--neon-green); color: #000; border-color: var(--neon-green); }
        .option-btn.wrong { background: rgba(255, 0, 85, 0.15); border-color: var(--neon-red); color: var(--neon-red); }
        .option-btn.wrong .key-cap { background: var(--neon-red); color: #fff; border-color: var(--neon-red); }
        .option-btn.disabled { opacity: 0.6; pointer-events: none; }

        .quiz-footer { margin-top: 25px; display: flex; justify-content: space-between; align-items: center; width: 100%; height: 50px; }
        .progress-dots { display: flex; gap: 4px; }
        .dot { width: 6px; height: 6px; border-radius: 50%; background: rgba(255,255,255,0.2); }
        .dot.active { background: var(--neon-blue); transform: scale(1.4); box-shadow: 0 0 8px var(--neon-blue); }
        .dot.completed { background: var(--neon-green); }

        .keyboard-tip {
            width: 100%; text-align: center; color: rgba(255,255,255,0.4); font-size: 0.8rem;
            margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 15px;
        }
        .key-hint { background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px; color: #fff; font-weight: 700; margin: 0 2px; }

        /* Buttons */
        .next-btn {
            background: linear-gradient(135deg, var(--neon-pink), #8f00ff);
            border: none; padding: 12px 28px; border-radius: 50px;
            color: white; font-weight: 800; font-size: 0.9rem; cursor: pointer;
            box-shadow: 0 0 20px rgba(188, 19, 254, 0.4); transition: 0.3s;
            opacity: 0; pointer-events: none; transform: translateY(10px);
            font-family: 'Outfit', sans-serif;
        }
        .next-btn.visible { opacity: 1; pointer-events: auto; transform: translateY(0); }
        
        /* Intro Button Pulse */
        .intro-btn { 
            opacity: 1; pointer-events: auto; transform: translateY(0); 
            background: linear-gradient(135deg, var(--neon-blue), var(--neon-green)); 
            animation: cta-pulse 2s infinite ease-in-out;
        }
        
        .secondary-btn {
            background: transparent; border: 2px solid rgba(255, 255, 255, 0.5); padding: 12px 28px;
            border-radius: 50px; color: white; font-family: 'Outfit', sans-serif;
            font-size: 0.9rem; font-weight: 800; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase;
        }
        .secondary-btn:hover { border-color: #fff; background: rgba(255,255,255,0.1); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

        #results-view { text-align: center; width: 100%; }
        .score-header { display: flex; justify-content: center; gap: 20px; align-items: center; margin-bottom: 20px; }
        .big-score {
            font-size: 3.5rem; font-weight: 800; 
            background: linear-gradient(to bottom, #fff, #aaa); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .leaderboard-container {
            width: 100%; background: rgba(0,0,0,0.2); border-radius: 20px; padding: 15px;
            border: 1px solid rgba(255,255,255,0.05); margin-bottom: 25px;
        }
        .lb-header {
            display: grid; grid-template-columns: 0.5fr 1.5fr 1fr 1fr 1fr;
            padding: 10px; color: var(--neon-blue); font-size: 0.75rem; font-weight: 800;
            letter-spacing: 1px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 10px;
        }
        .lb-row {
            display: grid; grid-template-columns: 0.5fr 1.5fr 1fr 1fr 1fr;
            padding: 10px; background: rgba(255,255,255,0.02); border-radius: 10px;
            margin-bottom: 6px; font-size: 0.85rem; transition: 0.3s; align-items: center;
        }
        .lb-row.highlight { background: rgba(255, 215, 0, 0.15); border: 1px solid var(--neon-gold); box-shadow: 0 0 15px rgba(255, 215, 0, 0.2); animation: pulse 2s infinite; }
        .lb-rank { font-weight: 800; color: #888; }
        .lb-name { font-weight: 600; color: #fff; text-align: left; padding-left: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .lb-score { font-weight: 800; color: var(--neon-green); }
        .lb-topic { font-size: 0.7rem; text-transform: uppercase; color: #aaa; }
        .lb-diff { font-size: 0.7rem; font-weight: 700; }
        
        .diff-tag-easy { color: var(--neon-green); }
        .diff-tag-mid { color: var(--neon-blue); }
        .diff-tag-hard { color: var(--neon-red); }

        .results-actions { display: flex; gap: 15px; justify-content: center; margin-top: 10px; align-items: center; }

        .view-section { display: none; width: 100%; animation: fadeIn 0.4s ease; flex-direction: column; align-items: center; }
        .view-section.active { display: flex; }
        .back-link {
            position: absolute; top: 20px; left: 20px; color: rgba(255,255,255,0.5);
            font-weight: 600; cursor: pointer; font-size: 0.9rem; transition: 0.2s;
        }
        .back-link:hover { color: #fff; }
        .new-record-anim { display: none; color: var(--neon-gold); font-weight: 800; font-size: 1.4rem; margin-bottom: 5px; animation: bounce 1s infinite; }
        .new-record-anim.show { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 159, 67, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(255, 159, 67, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 159, 67, 0); } }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .shake-anim { animation: shake 0.4s ease-in-out; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        
        @keyframes cta-pulse {
            0% { transform: scale(1); box-shadow: 0 0 20px rgba(0, 243, 255, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 0 30px rgba(10, 255, 104, 0.6); }
            100% { transform: scale(1); box-shadow: 0 0 20px rgba(0, 243, 255, 0.4); }
        }
    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div class="app-container">
        <div class="quiz-card" id="quiz-card">
            
            <div id="username-view" class="view-section active">
                <h1 class="game-title">IDENTIFY</h1>
                <p class="subtitle">Enter your name to begin</p>
                <input type="text" id="username-input" placeholder="Player One" maxlength="10" autocomplete="off">
                <button class="next-btn intro-btn" onclick="submitName()">ENTER ARCADE</button>
            </div>

            <div id="topic-view" class="view-section">
                <h1 class="game-title">NEON ARCADE</h1>
                <div class="user-profile-bar">
                    <span class="user-info-text">Playing as: <span id="intro-name-display" class="user-name-highlight">Player</span></span>
                    <button class="change-user-btn" onclick="changeUser()">Change</button>
                </div>
                <div class="topic-grid">
                    <div class="topic-card topic-history" onclick="selectTopic('Roman History')">
                        <div class="topic-icon">üèõÔ∏è</div><div class="topic-name">Roman History</div>
                    </div>
                    <div class="topic-card topic-tech" onclick="selectTopic('Tech')">
                        <div class="topic-icon">ü§ñ</div><div class="topic-name">Tech</div>
                    </div>
                    <div class="topic-card topic-finance" onclick="selectTopic('Finance')">
                        <div class="topic-icon">üí∞</div><div class="topic-name">Finance</div>
                    </div>
                    <div class="topic-card topic-econ" onclick="selectTopic('Economics')">
                        <div class="topic-icon">üåç</div><div class="topic-name">Economics</div>
                    </div>
                    <div class="topic-card topic-psych" onclick="selectTopic('Psychology')">
                        <div class="topic-icon">üß†</div><div class="topic-name">Psychology</div>
                    </div>
                </div>
            </div>

            <div id="difficulty-view" class="view-section">
                <div class="back-link" onclick="showView('topic-view')">‚Üê Back</div>
                <h1 class="game-title">DIFFICULTY</h1>
                <p class="subtitle" id="selected-topic-label">Select Mode</p>
                <div class="diff-grid">
                    <button class="diff-btn diff-easy" onclick="startGame(30)">EASY <span>30s</span></button>
                    <button class="diff-btn diff-mid" onclick="startGame(15)">MEDIUM <span>15s</span></button>
                    <button class="diff-btn diff-hard" onclick="startGame(10)">HARD <span>10s</span></button>
                </div>
            </div>

            <div id="game-view" class="view-section">
                <div class="stats-bar">
                    <div class="hud-left">
                        <div class="badge" style="background:rgba(255,255,255,0.1)">üë§ <span id="hud-user">Player</span></div>
                        <div class="badge topic-badge" id="hud-topic">TOPIC</div>
                        <div class="badge streak-badge" id="streak-badge">üî• 0</div>
                    </div>
                    <div class="timer-container">
                        <svg class="timer-svg" viewBox="0 0 60 60">
                            <circle style="fill:none; stroke:rgba(255,255,255,0.1); stroke-width:6;" cx="30" cy="30" r="25"></circle>
                            <circle class="timer-circle" id="timer-circle" cx="30" cy="30" r="25"></circle>
                        </svg>
                        <div class="timer-text" id="timer-text">15</div>
                    </div>
                </div>
                <div class="question-text" id="question-text">Loading...</div>
                <div class="options-grid" id="options-grid"></div>
                <div class="quiz-footer">
                    <div class="progress-dots" id="progress-dots"></div>
                    <button class="next-btn" id="next-btn">NEXT</button>
                </div>
                <div class="keyboard-tip">
                    Tip: Use <span class="key-hint">A</span> <span class="key-hint">B</span> <span class="key-hint">C</span> <span class="key-hint">D</span> to select, <span class="key-hint">Enter</span> next, <span class="key-hint">Esc</span> exit
                </div>
            </div>

            <div id="results-view" class="view-section">
                <div id="new-record-msg" class="new-record-anim">LEADERBOARD UPDATED!</div>
                <div class="score-header">
                    <div>
                        <div class="big-score" id="final-score">0%</div>
                        <p style="color:#aaa; font-size:0.9rem">SCORE</p>
                    </div>
                </div>
                <div class="leaderboard-container">
                    <div class="lb-header">
                        <span>#</span>
                        <span style="text-align:left; padding-left:5px">AGENT</span>
                        <span>PTS</span>
                        <span>TOPIC</span>
                        <span>MODE</span>
                    </div>
                    <div id="leaderboard-list"></div>
                </div>
                <div class="results-actions">
                    <button class="secondary-btn" onclick="showView('topic-view')">MENU</button>
                    <button class="next-btn visible" style="transform: translateY(0)" onclick="restartGame()">RETRY</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- CONTENT DATASET ---
        const quizData = {
          "Roman History": {
            "Easy": [
              { question: "Who is the legendary founder of Rome?", options: ["Remus", "Romulus", "Augustus", "Julius"], correct: 1 },
              { question: "Which famous general was assassinated on the Ides of March?", options: ["Nero", "Marc Antony", "Julius Caesar", "Caligula"], correct: 2 },
              { question: "What language did the ancient Romans speak?", options: ["Italian", "Greek", "Latin", "Romanian"], correct: 2 },
              { question: "Which massive amphitheater was used for gladiator battles?", options: ["The Pantheon", "The Colosseum", "The Forum", "The Circus Maximus"], correct: 1 },
              { question: "Who was the first Emperor of Rome?", options: ["Julius Caesar", "Tiberius", "Augustus", "Constantine"], correct: 2 },
              { question: "Which Roman Emperor is infamously associated with a great fire?", options: ["Nero", "Trajan", "Hadrian", "Claudius"], correct: 0 },
              { question: "What was the name of the wars fought between Rome and Carthage?", options: ["The Gallic Wars", "The Persian Wars", "The Punic Wars", "The Civil Wars"], correct: 2 },
              { question: "Which volcano erupted and destroyed Pompeii?", options: ["Mount Etna", "Mount Vesuvius", "Mount Stromboli", "Mount Fuji"], correct: 1 },
              { question: "Which religion became the official state religion under Theodosius I?", options: ["Judaism", "Christianity", "Paganism", "Zoroastrianism"], correct: 1 },
              { question: "What garment was worn by male Roman citizens?", options: ["Tunic", "Kilt", "Toga", "Robe"], correct: 2 }
            ],
            "Medium": [
              { question: "What does the phrase 'Crossing the Rubicon' signify historically?", options: ["Winning a war", "Point of no return", "Signing a treaty", "Building a bridge"], correct: 1 },
              { question: "Which Carthaginian general marched elephants across the Alps?", options: ["Hamilcar", "Hannibal", "Hasdrubal", "Scipio"], correct: 1 },
              { question: "Who were the members of the First Triumvirate?", options: ["Augustus, Antony, Lepidus", "Caesar, Pompey, Crassus", "Tiberius, Gaius, Claudius", "Scipio, Cato, Cicero"], correct: 1 },
              { question: "What was the primary function of the Praetorian Guard?", options: ["Guarding the Senate", "Fighting on the borders", "Bodyguards for the Emperor", "Collecting taxes"], correct: 2 },
              { question: "Which Emperor built a famous wall in northern Britain?", options: ["Trajan", "Hadrian", "Antoninus Pius", "Septimius Severus"], correct: 1 },
              { question: "What was the Edict of Milan (313 AD) famous for?", options: ["Banning gladiators", "Establishing the Tetrarchy", "Legalizing Christianity", "Fixing prices of goods"], correct: 2 },
              { question: "Which battle marked the end of the Roman Republic and the beginning of the Empire?", options: ["Battle of Cannae", "Battle of Zama", "Battle of Actium", "Battle of Pharsalus"], correct: 2 },
              { question: "Who were the Gracchi brothers?", options: ["Famous generals", "Reformist tribunes", "Legendary founders", "Architects"], correct: 1 },
              { question: "In which year did the Western Roman Empire traditionally fall?", options: ["410 AD", "476 AD", "1453 AD", "313 AD"], correct: 1 },
              { question: "What was the 'Pax Romana'?", options: ["A Roman tax law", "A long period of relative peace", "A treaty with Persia", "The Roman legal code"], correct: 1 }
            ],
            "Hard": [
              { question: "Which Emperor established the Tetrarchy, dividing rule between four leaders?", options: ["Constantine", "Diocletian", "Aurelian", "Galerius"], correct: 1 },
              { question: "What was the 'Lex Hortensia' (287 BC) significant for?", options: ["It made plebiscites binding on all citizens", "It outlawed dictatorship", "It established the census", "It created the office of Tribune"], correct: 0 },
              { question: "Who was the last Roman Emperor of the West?", options: ["Julius Nepos", "Romulus Augustulus", "Constantine XI", "Odoacer"], correct: 1 },
              { question: "Which battle saw the death of Emperor Valens and signaled the decline of the legions?", options: ["Battle of the Catalaunian Plains", "Battle of Adrianople", "Battle of Teutoburg Forest", "Battle of Milvian Bridge"], correct: 1 },
              { question: "What was Sulla's most infamous political tool used to eliminate enemies?", options: ["Damnatio Memoriae", "Decimation", "Proscriptions", "Exile to Pontus"], correct: 2 },
              { question: "Who was the only Roman Emperor to voluntarily retire?", options: ["Tiberius", "Diocletian", "Nerva", "Hadrian"], correct: 1 },
              { question: "Which Emperor attempted to restore paganism after Constantine?", options: ["Julian the Apostate", "Theodosius II", "Valentinian I", "Magnentius"], correct: 0 },
              { question: "What was the 'Donation of Constantine' eventually proven to be?", options: ["A lost territory", "A large charitable gift", "A forged document", "A religious relic"], correct: 2 },
              { question: "The 'Year of the Four Emperors' followed the death of which ruler?", options: ["Augustus", "Caligula", "Nero", "Commodus"], correct: 2 },
              { question: "Which general famously exclaimed 'Vare, legiones redde!' (Varus, give me back my legions)?", options: ["Tiberius", "Augustus", "Germanicus", "Drusus"], correct: 1 }
            ]
          },
          "Tech": {
            "Easy": [
              { question: "What does 'WWW' stand for in a website browser?", options: ["World Web Wide", "World Wide Web", "Wide World Web", "Web World Wide"], correct: 1 },
              { question: "Which company produces the iPhone?", options: ["Samsung", "Google", "Apple", "Microsoft"], correct: 2 },
              { question: "What device is primarily used to type into a computer?", options: ["Mouse", "Monitor", "Keyboard", "Printer"], correct: 2 },
              { question: "What does 'CPU' stand for?", options: ["Central Processing Unit", "Computer Personal Unit", "Central Power Unit", "Core Processing Unit"], correct: 0 },
              { question: "Who is the co-founder of Microsoft?", options: ["Steve Jobs", "Elon Musk", "Bill Gates", "Mark Zuckerberg"], correct: 2 },
              { question: "What is the most popular search engine in the world?", options: ["Bing", "Yahoo", "DuckDuckGo", "Google"], correct: 3 },
              { question: "Which part of the computer stores files permanently?", options: ["RAM", "Hard Drive / SSD", "CPU", "Motherboard"], correct: 1 },
              { question: "What symbol is used to tag users on Twitter/X?", options: ["#", "$", "@", "&"], correct: 2 },
              { question: "Which of these is an operating system?", options: ["Photoshop", "Windows", "Chrome", "Intel"], correct: 1 },
              { question: "What do you call a portable computer?", options: ["Desktop", "Server", "Laptop", "Mainframe"], correct: 2 }
            ],
            "Medium": [
              { question: "What does 'HTML' stand for?", options: ["Hyper Text Markup Language", "High Tech Multi Language", "Home Tool Markup Language", "Hyperlinks and Text Markup Language"], correct: 0 },
              { question: "Which programming language is known as the language of the web?", options: ["Java", "Python", "JavaScript", "C++"], correct: 2 },
              { question: "What is the main function of a DNS server?", options: ["Storing website files", "Translating domain names to IP addresses", "Encrypting passwords", "Boosting internet speed"], correct: 1 },
              { question: "In computer memory, what makes RAM different from ROM?", options: ["RAM is slower", "RAM is volatile (loses data when off)", "RAM is strictly read-only", "RAM stores the BIOS"], correct: 1 },
              { question: "What does 'Open Source' mean regarding software?", options: ["The software is free to download", "The source code is available for modification", "The software requires an internet connection", "The software has no security"], correct: 1 },
              { question: "Which protocol is used to secure websites (lock icon)?", options: ["HTTP", "FTP", "HTTPS", "SMTP"], correct: 2 },
              { question: "What is 'Phishing'?", options: ["Testing network speed", "A type of virus", "Fraudulent attempts to get sensitive info", "Mining cryptocurrency"], correct: 2 },
              { question: "What observation states that transistor counts double every two years?", options: ["Murphy's Law", "Cole's Law", "Moore's Law", "Amdahl's Law"], correct: 2 },
              { question: "Which operating system is based on the Linux kernel?", options: ["MacOS", "Android", "iOS", "Windows"], correct: 1 },
              { question: "What is the binary representation of the decimal number 5?", options: ["101", "110", "100", "111"], correct: 0 }
            ],
            "Hard": [
              { question: "Which cryptographic hashing algorithm is used in Bitcoin?", options: ["MD5", "SHA-1", "SHA-256", "AES-256"], correct: 2 },
              { question: "What constitutes the 'Three-Way Handshake' in TCP?", options: ["SYN, SYN-ACK, ACK", "PING, PONG, ACK", "GET, POST, CONNECT", "ACK, SYN, FIN"], correct: 0 },
              { question: "In database concepts, what does ACID stand for?", options: ["Atomicity, Consistency, Isolation, Durability", "Access, Control, Identification, Data", "Automatic, Complete, Instant, Distributed", "Association, Connectivity, Integration, Development"], correct: 0 },
              { question: "What is the time complexity of a binary search algorithm?", options: ["O(n)", "O(n^2)", "O(log n)", "O(1)"], correct: 2 },
              { question: "Which vulnerability affected nearly all modern processors in 2018?", options: ["WannaCry", "Spectre & Meltdown", "Heartbleed", "Stuxnet"], correct: 1 },
              { question: "What is the primary difference between a Virtual Machine and a Docker Container?", options: ["Containers have their own OS kernel", "VMs share the host OS kernel", "Containers share the host OS kernel", "VMs are faster to boot"], correct: 2 },
              { question: "Who is the pseudonymous creator of Bitcoin?", options: ["Vitalik Buterin", "Charlie Lee", "Satoshi Nakamoto", "Hal Finney"], correct: 2 },
              { question: "What does the 'cap theorem' state about distributed systems?", options: ["You can only have 2 of: Consistency, Availability, Partition Tolerance", "You need Consistency to have Availability", "Partition Tolerance is impossible", "Availability is guaranteed in all databases"], correct: 0 },
              { question: "Which port is standard for SSH connections?", options: ["80", "443", "22", "21"], correct: 2 },
              { question: "What does 'Polymorphism' refer to in Object-Oriented Programming?", options: ["Hiding data within a class", "A single interface for different data types", "Creating a new class from an existing one", "Copying memory addresses"], correct: 1 }
            ]
          },
          "Finance": {
            "Easy": [
              { question: "What do you call money you borrow that must be paid back?", options: ["Asset", "Loan", "Dividend", "Grant"], correct: 1 },
              { question: "What is the currency of the United Kingdom?", options: ["Euro", "Dollar", "Pound Sterling", "Franc"], correct: 2 },
              { question: "What does 'ATM' stand for?", options: ["Automated Teller Machine", "Automatic Transaction Money", "All Time Money", "Account Transfer Mode"], correct: 0 },
              { question: "When the stock market is doing very well, it is called a ___ market.", options: ["Bear", "Bull", "Pig", "Wolf"], correct: 1 },
              { question: "What is a 'Budget'?", options: ["A type of bank account", "A plan for income and spending", "A tax form", "A credit card limit"], correct: 1 },
              { question: "Which US agency collects taxes?", options: ["FBI", "CIA", "IRS", "FDA"], correct: 2 },
              { question: "What is the term for a share of ownership in a company?", options: ["Bond", "Stock", "Loan", "Certificate"], correct: 1 },
              { question: "If you spend more than you earn, you are in...", options: ["Debt", "Profit", "Surplus", "Equity"], correct: 0 },
              { question: "What is 'Interest' on a savings account?", options: ["A fee you pay the bank", "Money the bank pays you", "A tax on savings", "The cost of the debit card"], correct: 1 },
              { question: "Where is the major US stock exchange located?", options: ["Main Street", "Wall Street", "Broadway", "Pennsylvania Avenue"], correct: 1 }
            ],
            "Medium": [
              { question: "What does 'Diversification' mean in investing?", options: ["Putting all money in one stock", "Spreading investments to reduce risk", "Buying only tech stocks", "Selling assets quickly"], correct: 1 },
              { question: "What is a 'Dividend'?", options: ["The price of a stock", "A tax on profits", "A distribution of profits to shareholders", "A fee paid to a broker"], correct: 2 },
              { question: "What does 'IPO' stand for?", options: ["Initial Public Offering", "Internal Profit Organization", "International Price Option", "Immediate Purchase Order"], correct: 0 },
              { question: "What is the primary purpose of a 401(k)?", options: ["Health Insurance", "Retirement Savings", "College Fund", "Emergency Cash"], correct: 1 },
              { question: "If a company has a high P/E ratio, what might that imply?", options: ["It is bankrupt", "Investors expect high growth or it is overvalued", "It has no earnings", "It pays high dividends"], correct: 1 },
              { question: "What is 'Liquidity'?", options: ["How much debt a company has", "How easily an asset can be converted to cash", "The total value of stocks", "The flow of dividends"], correct: 1 },
              { question: "What is the difference between a Stock and a Bond?", options: ["Stocks are debt, Bonds are ownership", "Stocks are ownership, Bonds are debt", "They are the same", "Bonds are always riskier"], correct: 1 },
              { question: "Which score is used to determine creditworthiness in the US?", options: ["SAT Score", "FICO Score", "BMI Score", "ISO Score"], correct: 1 },
              { question: "What is 'Inflation'?", options: ["Decrease in prices", "Increase in the purchasing power of money", "General increase in prices and fall in purchasing value", "Stable prices over time"], correct: 2 },
              { question: "What is 'Compound Interest'?", options: ["Interest calculated only on the principal", "Interest calculated on principal and accumulated interest", "A fixed fee charged monthly", "Interest that decreases over time"], correct: 1 }
            ],
            "Hard": [
              { question: "What does 'Short Selling' a stock mean?", options: ["Buying it for a short time", "Betting the price will go down by selling borrowed shares", "Selling only a small portion of shares", "Buying shares from a short-term lender"], correct: 1 },
              { question: "In options trading, what does 'Delta' measure?", options: ["Time decay", "Volatility", "Rate of change of option price relative to underlying asset", "Rate of change of Delta"], correct: 2 },
              { question: "What does an 'Inverted Yield Curve' historically predict?", options: ["Hyperinflation", "Economic Recession", "A Bull Market", "Lower Taxes"], correct: 1 },
              { question: "What is 'EBITDA' used to evaluate?", options: ["Operating performance without tax/debt impact", "Net Income after all expenses", "Total Asset Turnover", "Shareholder Equity"], correct: 0 },
              { question: "What is the 'Wash Sale Rule'?", options: ["You must wash money before investing", "You cannot buy back a substantially identical stock within 30 days of selling at a loss", "You cannot sell stocks on rainy days", "Banks must report cash over $10k"], correct: 1 },
              { question: "What are 'Junk Bonds'?", options: ["Bonds made of recycled paper", "High-yield, high-risk bonds with low credit ratings", "Bonds issued by the government", "Stocks that have lost value"], correct: 1 },
              { question: "What was the purpose of the Sarbanes-Oxley Act of 2002?", options: ["To lower interest rates", "To bailout banks", "To protect investors from fraudulent accounting", "To establish the Euro"], correct: 2 },
              { question: "What is a 'Derivative' in finance?", options: ["A math problem", "A contract whose value derives from an underlying entity", "A division of a company", "A type of tax cut"], correct: 1 },
              { question: "What is the definition of an 'Accredited Investor' in the US (roughly)?", options: ["Anyone with a job", "Someone with $200k+ income or $1M+ net worth", "Someone who works at a bank", "Anyone over age 65"], correct: 1 },
              { question: "In Forex, what is a 'Pip'?", options: ["Percentage in Point (smallest price move)", "Profit in Portfolio", "Price Index Point", "Purchase Interest Parity"], correct: 0 }
            ]
          },
          "Economics": {
            "Easy": [
              { question: "What is the basic economic problem caused by unlimited wants and limited resources?", options: ["Poverty", "Scarcity", "Inflation", "Monopoly"], correct: 1 },
              { question: "When the price of a good goes up, demand usually...", options: ["Goes up", "Goes down", "Stays the same", "Disappears"], correct: 1 },
              { question: "What is a 'Monopoly'?", options: ["A board game only", "A market with many sellers", "A market with only one seller", "A government tax"], correct: 2 },
              { question: "What does GDP stand for?", options: ["Gross Domestic Product", "General Daily Price", "Global Dollar Power", "Government Debt Percentage"], correct: 0 },
              { question: "Goods brought into a country from abroad are called...", options: ["Exports", "Imports", "Tariffs", "Embargoes"], correct: 1 },
              { question: "What involves trading goods directly for other goods without money?", options: ["Credit", "Barter", "Debit", "Investing"], correct: 1 },
              { question: "Which system relies on private ownership and profit motive?", options: ["Capitalism", "Communism", "Feudalism", "Socialism"], correct: 0 },
              { question: "What is a 'Recession'?", options: ["A period of economic growth", "A period of economic decline", "A rise in stock prices", "A new tax law"], correct: 1 },
              { question: "Items that are necessary for survival are called...", options: ["Wants", "Luxuries", "Needs", "Services"], correct: 2 },
              { question: "Who constitutes the 'Labor Force'?", options: ["Everyone in a country", "Only people with jobs", "Employed plus unemployed looking for work", "Retired people"], correct: 2 }
            ],
            "Medium": [
              { question: "What is 'Opportunity Cost'?", options: ["The price of a product", "The value of the next best alternative given up", "The cost of starting a business", "The tax on an opportunity"], correct: 1 },
              { question: "Who is considered the 'Father of Economics' and wrote 'The Wealth of Nations'?", options: ["Karl Marx", "John Maynard Keynes", "Adam Smith", "Milton Friedman"], correct: 2 },
              { question: "What does 'Price Elasticity' measure?", options: ["How much price changes over time", "How responsive quantity demanded is to a price change", "The cost of rubber", "Government control on prices"], correct: 1 },
              { question: "What distinguishes an 'Oligopoly'?", options: ["One seller", "Infinite sellers", "A few large sellers dominating the market", "Government ownership"], correct: 2 },
              { question: "What is the difference between Fiscal and Monetary policy?", options: ["Fiscal is banking; Monetary is taxes", "Fiscal is Govt spending/taxes; Monetary is money supply/rates", "They are the same", "Fiscal is international; Monetary is domestic"], correct: 1 },
              { question: "What is 'Fiat Money'?", options: ["Money backed by gold", "Money backed by silver", "Currency that has value because the government says so", "Cryptocurrency"], correct: 2 },
              { question: "What is 'Structural Unemployment'?", options: ["Being between jobs", "Unemployment due to recession", "Mismatch of skills between workers and jobs", "Seasonal unemployment"], correct: 2 },
              { question: "What is a 'Trade Deficit'?", options: ["Exporting more than importing", "Importing more than exporting", "Trading illegal goods", "Stopping all trade"], correct: 1 },
              { question: "What is the 'Invisible Hand' theory?", options: ["Government controlling the market secretly", "Self-interested actions leading to positive social outcomes", "Theft in the economy", "The impact of charity"], correct: 1 },
              { question: "What happens in 'Hyperinflation'?", options: ["Prices rise extremely quickly, money loses value", "Prices drop quickly", "The economy grows very fast", "Unemployment hits 0%"], correct: 0 }
            ],
            "Hard": [
              { question: "What does the 'Phillips Curve' illustrate?", options: ["The inverse relationship between unemployment and inflation", "The relationship between tax rates and revenue", "Supply vs Demand", "Population growth vs Food supply"], correct: 0 },
              { question: "What is the 'Gini Coefficient' used to measure?", options: ["GDP Growth", "Income Inequality", "Stock Market Volatility", "Inflation Rate"], correct: 1 },
              { question: "What is 'Deadweight Loss'?", options: ["The cost of a funeral", "A loss of economic efficiency when equilibrium is not achieved", "Money lost in the stock market", "The debt of a bankrupt company"], correct: 1 },
              { question: "What implies the 'Tragedy of the Commons'?", options: ["Common people are always poor", "Individuals deplete a shared resource acting in self-interest", "Public parks are expensive", "Communism always fails"], correct: 1 },
              { question: "What is the 'Keynesian Multiplier'?", options: ["Banks doubling money", "An increase in spending produces an increase in national income greater than the initial amount", "Taxes multiply debt", "Population growth formula"], correct: 1 },
              { question: "What is a 'Pigovian Tax'?", options: ["A tax on farm animals", "A tax on activities that generate negative externalities", "A tax on the rich", "A tax on imports"], correct: 1 },
              { question: "What is 'Comparative Advantage' based on?", options: ["Who can produce the most", "Who has the most money", "Who has the lower opportunity cost of production", "Who has the biggest military"], correct: 2 },
              { question: "What event was the 'Nixon Shock' in 1971?", options: ["The stock market crash", "The end of the Vietnam War", "Taking the US Dollar off the Gold Standard", "Nixon's resignation"], correct: 2 },
              { question: "What does the 'Laffer Curve' suggest?", options: ["Higher taxes always mean more revenue", "Lower taxes always mean more revenue", "There is an optimal tax rate that maximizes revenue, beyond which it decreases", "Inflation is caused by laughter"], correct: 2 },
              { question: "What is a 'Deflationary Spiral'?", options: ["Prices fall -> Lower production -> Lower wages -> Lower demand -> Prices fall further", "Prices rise -> Wages rise -> Prices rise", "Stock market crash loop", "Government debt default"], correct: 0 }
            ]
          },
          "Psychology": {
            "Easy": [
              { question: "Who is known for the experiment with dogs and bells?", options: ["Sigmund Freud", "Ivan Pavlov", "Carl Jung", "B.F. Skinner"], correct: 1 },
              { question: "What is a 'Phobia'?", options: ["A type of dream", "An intense, irrational fear", "A memory loss", "A personality type"], correct: 1 },
              { question: "Which organ is the center of the nervous system?", options: ["Heart", "Brain", "Spine", "Stomach"], correct: 1 },
              { question: "What does 'Introvert' generally mean?", options: ["Someone who loves crowds", "Someone who gains energy from solitude", "Someone who is angry", "Someone with high IQ"], correct: 1 },
              { question: "What stage of sleep is associated with dreaming?", options: ["NREM", "Deep Sleep", "REM", "Light Sleep"], correct: 2 },
              { question: "Who is the father of Psychoanalysis?", options: ["Ivan Pavlov", "Sigmund Freud", "Abraham Maslow", "Jean Piaget"], correct: 1 },
              { question: "What is 'Deja Vu'?", options: ["Forgetting a name", "Feeling like you have experienced a situation before", "A lucid dream", "A panic attack"], correct: 1 },
              { question: "What hormone is often called the 'fight or flight' hormone?", options: ["Insulin", "Adrenaline", "Melatonin", "Estrogen"], correct: 1 },
              { question: "What does IQ stand for?", options: ["Intellect Quotient", "Intelligence Quotient", "Inner Quality", "Idea Quantity"], correct: 1 },
              { question: "Which of these is a facial expression of emotion?", options: ["Sneezing", "Smiling", "Coughing", "Hiccuping"], correct: 1 }
            ],
            "Medium": [
              { question: "What is the difference between Classical and Operant conditioning?", options: ["Classical is voluntary; Operant is involuntary", "Classical associates stimuli; Operant associates behavior with consequences", "They are the same", "Operant uses dogs; Classical uses rats"], correct: 1 },
              { question: "What is at the top of Maslow's Hierarchy of Needs?", options: ["Safety", "Love/Belonging", "Self-Actualization", "Physiological"], correct: 2 },
              { question: "What is the 'Placebo Effect'?", options: ["Getting sick from worry", "Improvement due to believing a treatment works, not the treatment itself", "A side effect of medicine", "The study of places"], correct: 1 },
              { question: "What is 'Cognitive Dissonance'?", options: ["Mental harmony", "Discomfort felt when holding conflicting beliefs", " forgetting things easily", "A type of therapy"], correct: 1 },
              { question: "According to Freud, which part of the psyche acts as the moral conscience?", options: ["Id", "Ego", "Superego", "Unconscious"], correct: 2 },
              { question: "What was the Stanley Milgram experiment testing?", options: ["Memory", "Obedience to authority", "Vision", "Sleep deprivation"], correct: 1 },
              { question: "What is 'Confirmation Bias'?", options: ["Confirming appointments", "Favoring information that confirms existing beliefs", "Being unbiased", "Checking facts twice"], correct: 1 },
              { question: "What is the 'Bystander Effect'?", options: ["People help more when in groups", "Individuals are less likely to help when others are present", "People enjoy watching crowds", "Walking past a shop"], correct: 1 },
              { question: "What is the capacity of short-term memory (Miller's Law)?", options: ["Unlimited", "7 plus or minus 2 items", "100 items", "1 item"], correct: 1 },
              { question: "Which part of the brain is primarily associated with fear?", options: ["Hippocampus", "Amygdala", "Cerebellum", "Frontal Lobe"], correct: 1 }
            ],
            "Hard": [
              { question: "Which of the following is NOT one of the 'Big Five' personality traits?", options: ["Openness", "Conscientiousness", "Neuroticism", "Aggressiveness"], correct: 3 },
              { question: "What does the 'Rosenhan Experiment' (Being Sane in Insane Places) critique?", options: ["The validity of psychiatric diagnosis", "The cost of healthcare", "The effectiveness of pills", "The IQ test"], correct: 0 },
              { question: "What is the 'Hawthorne Effect'?", options: ["Lighting changes mood", "Subjects modify behavior simply because they are being observed", "Plants grow better with music", "Workers are lazy"], correct: 1 },
              { question: "Who developed the stages of Cognitive Development (Sensorimotor, etc.)?", options: ["Jean Piaget", "Erik Erikson", "Lev Vygotsky", "Carl Rogers"], correct: 0 },
              { question: "What is 'Semantic Memory'?", options: ["Memory of personal events", "General world knowledge and facts", "Muscle memory", "Short-term memory"], correct: 1 },
              { question: "Damage to 'Broca‚Äôs Area' results in difficulty with what?", options: ["Vision", "Speech production", "Understanding language", "Balance"], correct: 1 },
              { question: "What is the 'Dunning-Kruger Effect'?", options: ["Smart people think they are dumb", "Low-ability people overestimate their competence", "Experts are always right", "Learning makes you sad"], correct: 1 },
              { question: "What is the main purpose of the DSM-5?", options: ["To prescribe medication", "To diagnose mental disorders", "To license therapists", "To study brain anatomy"], correct: 1 },
              { question: "Elizabeth Loftus is famous for her research on what?", options: ["Dream interpretation", "The fallibility of eyewitness testimony and false memories", "Child development", "Animal behavior"], correct: 1 },
              { question: "What do Gestalt psychologists emphasize?", options: ["The whole is greater than the sum of its parts", "Analyze every small piece", "Dreams are reality", "Behavior is just reflexes"], correct: 0 }
            ]
          }
        };

        // --- STATE ---
        let username = "Player";
        let currentTopic = '';
        let currentQuestions = [];
        let currentQIndex = 0;
        let score = 0;
        let streak = 0;
        let timerSetting = 15;
        let timeLeft = 0;
        let timerInterval;
        let audioCtx;

        // --- DOM ---
        const ui = {
            card: document.getElementById('quiz-card'),
            timerCircle: document.getElementById('timer-circle'),
            timerText: document.getElementById('timer-text'),
            question: document.getElementById('question-text'),
            options: document.getElementById('options-grid'),
            dots: document.getElementById('progress-dots'),
            nextBtn: document.getElementById('next-btn'),
            hudTopic: document.getElementById('hud-topic'),
            hudUser: document.getElementById('hud-user'),
            introNameDisplay: document.getElementById('intro-name-display'),
            streakBadge: document.getElementById('streak-badge'),
            finalScore: document.getElementById('final-score'),
            newRecordMsg: document.getElementById('new-record-msg'),
            selectedTopicLabel: document.getElementById('selected-topic-label'),
            userInput: document.getElementById('username-input'),
            lbList: document.getElementById('leaderboard-list'),
            gameView: document.getElementById('game-view')
        };

        // --- NAVIGATION ---
        function showView(viewId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            if(!audioCtx) initAudio();
            
            // Clean up timers if leaving game view
            if (viewId !== 'game-view') {
                clearInterval(timerInterval);
            }
        }

        function submitName() {
            const val = ui.userInput.value.trim();
            if(val) {
                username = val;
                updateNameDisplay();
                playSound('click');
                showView('topic-view');
            } else {
                ui.userInput.style.borderColor = 'var(--neon-red)';
                playSound('wrong');
                setTimeout(() => ui.userInput.style.borderColor = 'rgba(255,255,255,0.1)', 500);
            }
        }
        ui.userInput.addEventListener("keypress", (e) => { if (e.key === "Enter") submitName(); });

        function changeUser() {
            ui.userInput.value = username;
            showView('username-view');
            playSound('click');
        }

        function updateNameDisplay() {
            ui.introNameDisplay.innerText = username;
            ui.hudUser.innerText = username;
        }

        function selectTopic(topicKey) {
            currentTopic = topicKey;
            ui.selectedTopicLabel.innerText = `For ${currentTopic}`;
            showView('difficulty-view');
            playSound('click');
        }

        // --- GAME LOGIC ---
        function getDifficultyLabel(sec) {
            if(sec === 30) return { text: "EASY", class: "diff-tag-easy", key: "Easy" };
            if(sec === 15) return { text: "MED", class: "diff-tag-mid", key: "Medium" };
            return { text: "HARD", class: "diff-tag-hard", key: "Hard" };
        }

        function startGame(seconds) {
            timerSetting = seconds;
            const diffInfo = getDifficultyLabel(seconds);
            
            // LOAD DATA BASED ON DIFFICULTY
            currentQuestions = quizData[currentTopic][diffInfo.key];
            
            currentQIndex = 0; score = 0; streak = 0;
            updateStreak();

            ui.hudTopic.innerText = currentTopic;
            ui.hudUser.innerText = username;
            
            ui.dots.innerHTML = '';
            currentQuestions.forEach((_, i) => {
                const d = document.createElement('div');
                d.className = i === 0 ? 'dot active' : 'dot';
                ui.dots.appendChild(d);
            });

            showView('game-view');
            loadQuestion();
        }

        function restartGame() {
            startGame(timerSetting);
        }

        function loadQuestion() {
            const data = currentQuestions[currentQIndex];
            ui.card.classList.remove('shake-anim');
            ui.nextBtn.classList.remove('visible');
            ui.question.innerText = data.question;
            ui.options.innerHTML = '';

            const keys = ['A', 'B', 'C', 'D'];
            data.options.forEach((opt, i) => {
                const btn = document.createElement('div');
                btn.className = 'option-btn';
                btn.innerHTML = `<span class="key-cap">${keys[i]}</span> <span>${opt}</span>`;
                btn.onclick = () => handleAnswer(i, btn);
                ui.options.appendChild(btn);
            });

            Array.from(ui.dots.children).forEach((d, i) => {
                d.className = 'dot';
                if (i === currentQIndex) d.classList.add('active');
                else if (i < currentQIndex) d.classList.add('completed');
            });

            startTimer();
        }

        function handleAnswer(index, btn) {
            if (ui.nextBtn.classList.contains('visible')) return;
            clearInterval(timerInterval);

            const correct = currentQuestions[currentQIndex].correct;
            const options = document.querySelectorAll('.option-btn');
            options.forEach(o => o.classList.add('disabled'));

            if (index === correct) {
                btn.classList.add('correct');
                playSound('correct');
                score++; streak++;
                const rect = btn.getBoundingClientRect();
                createParticles(rect.left + rect.width/2, rect.top + rect.height/2);
            } else {
                btn.classList.add('wrong');
                options[correct].classList.add('correct');
                playSound('wrong');
                streak = 0;
                ui.card.classList.add('shake-anim');
            }
            updateStreak();
            ui.nextBtn.classList.add('visible');
        }

        function nextQuestion() {
            currentQIndex++;
            if (currentQIndex < currentQuestions.length) loadQuestion();
            else endGame();
        }
        
        function handleTimeout() {
            playSound('wrong');
            streak = 0; updateStreak();
            const correct = currentQuestions[currentQIndex].correct;
            const options = document.querySelectorAll('.option-btn');
            options.forEach(o => o.classList.add('disabled'));
            options[correct].classList.add('correct');
            setTimeout(nextQuestion, 1500);
        }

        function startTimer() {
            timeLeft = timerSetting;
            ui.timerText.innerText = timeLeft;
            ui.timerCircle.style.strokeDashoffset = 0;
            ui.timerCircle.style.stroke = "var(--neon-blue)";

            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                ui.timerText.innerText = timeLeft;
                const offset = 157 - (timeLeft / timerSetting) * 157;
                ui.timerCircle.style.strokeDashoffset = offset;
                if (timeLeft <= 5) ui.timerCircle.style.stroke = "var(--neon-red)";
                if (timeLeft <= 0) { clearInterval(timerInterval); handleTimeout(); }
            }, 1000);
        }

        // --- LEADERBOARD & RESULTS ---
        function updateLeaderboard() {
            const LB_KEY = 'neonQuiz_globalLB';
            let leaderboard = JSON.parse(localStorage.getItem(LB_KEY)) || [];
            
            const runId = Date.now(); 
            const diffInfo = getDifficultyLabel(timerSetting);

            const newEntry = {
                id: runId,
                name: username,
                score: score,
                topic: currentTopic, 
                diffText: diffInfo.text,
                diffClass: diffInfo.class
            };

            leaderboard.push(newEntry);
            leaderboard.sort((a, b) => b.score - a.score);
            leaderboard = leaderboard.slice(0, 5);

            localStorage.setItem(LB_KEY, JSON.stringify(leaderboard));
            renderLeaderboard(leaderboard, runId);
            return leaderboard.some(entry => entry.id === runId);
        }

        function renderLeaderboard(data, currentId) {
            ui.lbList.innerHTML = '';
            if(data.length === 0) {
                ui.lbList.innerHTML = '<div style="padding:10px; color:#666">No records yet</div>';
                return;
            }

            data.forEach((entry, index) => {
                const row = document.createElement('div');
                row.className = entry.id === currentId ? 'lb-row highlight' : 'lb-row';
                
                row.innerHTML = `
                    <span class="lb-rank">${index + 1}</span>
                    <span class="lb-name">${entry.name}</span>
                    <span class="lb-score">${entry.score}/10</span>
                    <span class="lb-topic">${entry.topic}</span>
                    <span class="lb-diff ${entry.diffClass}">${entry.diffText}</span>
                `;
                ui.lbList.appendChild(row);
            });
        }

        function endGame() {
            showView('results-view');
            const percent = Math.round((score / 10) * 100);
            ui.finalScore.innerText = `${percent}%`;

            const isNewRecord = updateLeaderboard();

            if (isNewRecord) {
                ui.newRecordMsg.classList.add('show');
                playSound('highscore');
                createParticles(window.innerWidth/2, window.innerHeight/2);
            } else {
                ui.newRecordMsg.classList.remove('show');
                if (percent > 60) playSound('correct');
            }
        }

        function updateStreak() {
            ui.streakBadge.innerText = `üî• ${streak}`;
            streak >= 3 ? ui.streakBadge.classList.add('on-fire') : ui.streakBadge.classList.remove('on-fire');
        }

        ui.nextBtn.onclick = () => { playSound('click'); nextQuestion(); };

        // --- CONTROLS & FX ---
        document.addEventListener('keydown', (e) => {
            const key = e.key.toLowerCase();

            // ESC Key Handling (Back/Menu)
            if (key === 'escape') {
                if (document.getElementById('difficulty-view').classList.contains('active')) {
                    playSound('click');
                    showView('topic-view');
                } else if (document.getElementById('game-view').classList.contains('active')) {
                    // Optional: Confirm dialog? For arcade speed, just quit.
                    playSound('click');
                    showView('topic-view');
                } else if (document.getElementById('results-view').classList.contains('active')) {
                    playSound('click');
                    showView('topic-view');
                }
                return;
            }

            if (!ui.gameView.classList.contains('active')) return;
            const validKeys = ['a', 'b', 'c', 'd'];
            if (validKeys.includes(key)) {
                const index = validKeys.indexOf(key);
                const options = document.querySelectorAll('.option-btn');
                if (options[index] && !options[index].classList.contains('disabled')) {
                    handleAnswer(index, options[index]);
                }
            }
            if (key === 'enter' && ui.nextBtn.classList.contains('visible')) {
                playSound('click'); nextQuestion();
            }
        });

        function initAudio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        function playSound(type) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;

            if (type === 'correct') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(600, now); osc.frequency.exponentialRampToValueAtTime(1200, now+0.1);
                gain.gain.setValueAtTime(0.2, now); gain.gain.exponentialRampToValueAtTime(0.01, now+0.5);
                osc.start(now); osc.stop(now+0.5);
            } else if (type === 'wrong') {
                osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, now); osc.frequency.linearRampToValueAtTime(100, now+0.2);
                gain.gain.setValueAtTime(0.2, now); gain.gain.linearRampToValueAtTime(0.01, now+0.3);
                osc.start(now); osc.stop(now+0.3);
            } else if (type === 'click') {
                osc.type = 'triangle'; osc.frequency.setValueAtTime(800, now); 
                gain.gain.setValueAtTime(0.05, now); gain.gain.exponentialRampToValueAtTime(0.001, now+0.05);
                osc.start(now); osc.stop(now+0.05);
            } else if (type === 'highscore') {
                osc.type = 'square'; osc.frequency.setValueAtTime(440, now); osc.frequency.setValueAtTime(880, now+0.3);
                gain.gain.setValueAtTime(0.2, now); gain.gain.linearRampToValueAtTime(0, now+1);
                osc.start(now); osc.stop(now+1);
            }
        }

        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
        window.onresize();

        function createParticles(x, y) {
            const colors = ['#00f3ff', '#bc13fe', '#0aff68', '#ffd700'];
            for(let i=0; i<30; i++) particles.push({
                x, y, vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10, life: 1, color: colors[Math.floor(Math.random()*colors.length)]
            });
        }
        function animateParticles() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            particles.forEach((p,i) => {
                p.x+=p.vx; p.y+=p.vy; p.life-=0.02; p.vy+=0.2;
                ctx.globalAlpha=p.life; ctx.fillStyle=p.color; ctx.beginPath(); ctx.arc(p.x,p.y,4,0,Math.PI*2); ctx.fill();
                if(p.life<=0) particles.splice(i,1);
            });
            requestAnimationFrame(animateParticles);
        }
        animateParticles();
    </script>
</body>
</html>
